{% extends 'publicpage/base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
    <!-- Header & Filter -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">Properties</h2>
        <form class="d-flex" method="GET">
            <input class="form-control me-2" type="search" placeholder="Search location..." name="q"
                value="{{ query }}">
            <button class="btn btn-outline-primary" type="submit">Search</button>
        </form>
    </div>

    <!-- Properties Grid -->
    <div class="row g-4">
        {% for property in page_obj %}
        <div class="col-md-4">
            <div class="card property-card h-100">
                <div class="position-relative overflow-hidden">
                    {% if property.images.first %}
                    <img src="{{ property.images.first.image.url }}" class="card-img-top" alt="{{ property.title }}">
                    {% else %}
                    <img src="https://via.placeholder.com/400x300?text=No+Image" class="card-img-top" alt="No image">
                    {% endif %}
                    <div class="position-absolute bottom-0 start-0 w-100 p-2 bg-primary text-white text-center fw-bold small"
                        style="opacity: 0.9;">
                        {{ property.get_property_type_display }}
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title"><a href="{% url 'property_detail' property.slug %}" class="text-dark">{{
                            property.title }}</a></h5>
                    <p class="text-muted small mb-3"><i class="bi bi-geo-alt-fill text-primary"></i> {{
                        property.location }}</p>
                    <span class="price-tag">${{ property.price }}</span>
                </div>
                <div class="card-footer d-flex justify-content-between text-muted small">
                    <span><i class="bi bi-aspect-ratio"></i> {{ property.area_sqft }} sqft</span>
                    <span><i class="bi bi-lamp"></i> {{ property.bedrooms }} Bed</span>
                    <span><i class="bi bi-droplet"></i> {{ property.bathrooms }} Bath</span>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 py-5 text-center">
            <h3>No properties found matching your criteria.</h3>
            <a href="{% url 'property_list' %}" class="btn btn-primary mt-3">View All</a>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <nav aria-label="Page navigation" class="mt-5">
        <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link"
                    href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}">Previous</a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">Previous</span></li>
            {% endif %}

            {% for i in page_obj.paginator.page_range %}
            {% if page_obj.number == i %}
            <li class="page-item active"><span class="page-link">{{ i }}</span></li>
            {% else %}
            <li class="page-item"><a class="page-link" href="?page={{ i }}{% if query %}&q={{ query }}{% endif %}">{{ i
                    }}</a></li>
            {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link"
                    href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}">Next</a></li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">Next</span></li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}